<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Plane Vis</title>
    <style type="text/css">
        html{height:90%}
        body{height:100%;margin:50px;padding:0px;width:60%}
        #container{height:100%}
    </style>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&32032a1889c8283166fe3df83b3fd856"></script>

</head>

<body>
<div id="container"></div>

<script src="vendor/jquery/dist/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
    var map = new AMap.Map("container",{
//        zoom: 0.2,
        center: [117.10, 39.10]
    });          // 创建地图实例
//    map.setZoom(0);


    AMap.plugin(['AMap.ToolBar','AMap.Scale'],function(){
        var toolBar = new AMap.ToolBar();
        var scale = new AMap.Scale();
        map.addControl(toolBar);
        map.addControl(scale);
    });

    var satellite = new  AMap.TileLayer.Satellite({
            map:map,
            zIndex:0,
            opacity:0.2
    });
//    var canvas = document.createElement('canvas');
//    canvas.width = map.getSize().width;
//    canvas.height = map.getSize().height;
//    var customLayer = new AMap.CustomLayer(canvas, {
//        zooms: [3, 8],
//        zIndex: 12
//    });
//    customLayer.setMap(map);



    var rootUrl = "http://localhost:8080/Plane/simulation";

    function loadData(){
        $.ajax({
            url: rootUrl,
//             contentType:"application/json",
            type: 'get',
            // dataType: 'json'

            dataType:'JSON'
            // dataType: 'json'
//             data:JSON.stringify(newApply)
        }).success(function(data){

            for(var i = 0;i < data.length;i++){
                var plane = data[i];
                var infoWindow = new AMap.InfoWindow();
                function markerOver(e){
                    infoWindow.setContent(e.target.content);
                    infoWindow.open(map, e.target.getCenter( ));
                }
                function markerOut(e){
//                    infoWindow.setContent(e.target.content);
                    infoWindow.close(map, e.target.getCenter( ));
                }

                // 创建点坐标
                var marker = new AMap.Circle({
                    center: [plane.lon, plane.lat],
                    map:map,
                    fillColor:"#"+plane.icao,
                    strokeWeight:0,
                    radius:300
//                    animation:"AMAP_ANIMATION_DROP"
                });
                marker.content=  "<h4>"+plane.flight+"</h4><table>"+
                "<tr><td>机名</td><td>"+(plane.flight)+"</td></tr>"+
                "<tr><td>飞机编号</td><td>  "+(plane.icao)+"</td></tr>"+
                "<tr><td>经度</td><td>  "+(plane.lon)+"</td></tr>"+
                "<tr><td>纬度</td><td>  "+(plane.lat)+"</td></tr>"+
                "<tr><td>海拔</td><td>  "+(plane.alt)+"</td></tr>"+
                "<tr><td>速度</td><td>  "+(plane.speed)+"</td></tr>"+
                "<tr><td>方向</td><td>  "+(plane.trueTrack)+"</td></tr>"+
                "<tr><td>垂直速度</td><td>  "+(plane.vrate)+"</td></tr>"+
                "<tr><td>距离</td><td>  "+(plane.dist)+"</td></tr>"+
                "<tr><td>国家</td><td>  "+(plane.country)+"</td></tr>"+
                "</table>";
                //给Marker绑定单击事件
                marker.on('click', markerOver);
                marker.on('mouseover',markerOver);
                marker.on('mouseout',markerOut);

            }

        }).error(function(data){
//            alert("获取失败");
            console.log(data);
            alert(data);
        });
    }

    function getNext(){
        $.ajax({
            url: rootUrl+ "/update",
//             contentType:"application/json",
            type: 'get',
            dataType:'JSON'
            // dataType: 'json'
//             data:JSON.stringify(newApply)
        }).success(function(data){
            // alert(data);
        }).error(function(){
//            alert("获取失败");
        });
    }

    function startChinaModel() {
        loadData();
        getNext();
        setInterval(function() {
            loadData();
            getNext();

        }, 4000);
    }


    $(document).ready(function() {
        startChinaModel();
    });

</script>
</body>
</html>