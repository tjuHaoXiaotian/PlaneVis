<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Plane Vis</title>
    <style type="text/css">
        html{height:90%}
        body{height:100%;margin:50px;padding:0px;width:60%}
        #container{height:100%}
    </style>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&32032a1889c8283166fe3df83b3fd856"></script>

</head>

<body>
<div id="container"></div>

<script src="vendor/jquery/dist/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
    var map = new AMap.Map("container",{
//        zoom: 0.2,
        center: [117.10, 39.10]
    });          // 创建地图实例
//    map.setZoom(0);


    AMap.plugin(['AMap.ToolBar','AMap.Scale'],function(){
        var toolBar = new AMap.ToolBar();
        var scale = new AMap.Scale();
        map.addControl(toolBar);
        map.addControl(scale);
    });

    var satellite = new  AMap.TileLayer.Satellite({
            map:map,
            zIndex:0,
            opacity:0.2
    });

//    var marker = new AMap.Polyline({
//                        map:map,
//                        fillColor:"#f00",
//                        strokeColor:10,
//                        storkeStyle:"solid",
//                        path:[[117.36884,39.08735],[120.36884,20.08735]]
//    //                    animation:"AMAP_ANIMATION_DROP"
//                    });




    var serverUrl = "http://192.168.1.103:8081/SavePlanes/mng/planes";



    function loadRecordDays(){
        $.ajax({
            url: serverUrl + "/days",
            type: 'get',
            dataType:'JSON'
        }).success(function(data){
            var days = [];
            days  = data;

            for(var i = 0; i < days.length-1;i++){
                loadPlaneNames(days[i],days[i+1]);
                console.log("数据是:\n"+days[i]);
            }

        }).error(function(data){
//            alert("获取失败");
            console.log(data);
            alert(data);
        });
    }


    function loadPlaneNames(from,to){
        $.ajax({
            url: serverUrl + "/names",
//             contentType:"application/json",
            type: 'get',
            dataType:'JSON',
            data:{
                selectDayFrom:from,
                selectDayTo:to
            }
        }).success(function(data){
            var names = [];
             names  = data;

            for(var i = 0; i < names.length;i++){
                loadEachPlane(names[i],from,to);
                console.log("数据是:\n"+names[i]);
            }

        }).error(function(data){
//            alert("获取失败");
            console.log(data);
            alert(data);
        });

    }

    function loadEachPlane(data,from,to){
        $.ajax({
            url: serverUrl + "/track",
//             contentType:"application/json",
            type: 'get',
            dataType:'JSON',
            data:{
                fli:data,
                selectDayFrom:from,
                selectDayTo:to
            }
        }).success(function(data){

            console.log("数据：\n" + data);
            var marker = new AMap.Polyline({
                map:map,
                strokeWeight:2,
                strokeColor:getRandomColor(),
                storkeStyle:"solid",
                path:data
                //                    animation:"AMAP_ANIMATION_DROP"
            });

        }).error(function(data){
//            alert("获取失败");
            console.log(data);
            alert(data);
        });

    }

    function getRandomColor(){

        return '#'+(Math.random()*0xffffff<<0).toString(16);
    }



    $(document).ready(function() {
        loadRecordDays();
    });


</script>
</body>
</html>