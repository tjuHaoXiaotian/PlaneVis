<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Plane Vis</title>
    <style type="text/css">
        html{height:90%}
        body{height:100%;margin:50px;padding:0px;width:100%}
        #container{height:100%;width:60%;margin-top:50px}
        #map5{width:40%;margin-top:50px}
    </style>
    <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.min.css" />

    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&32032a1889c8283166fe3df83b3fd856"></script>

    <script src="vendor/jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="js/d3.js"></script>
    <!--<script src="js/leftView.js" type="text/javascript"></script>-->
</head>

<body>


        <div class="col-sm-6 col-lg-6" id="container">

        </div>

        <div class="col-sm-4 col-lg-4" id="right">

                <div id="map5" >
                    map5
                    <h3>侧视图</h3>
                </div>
                <h4 class="col-md-offset-4">北  <——>   南                     侧视图</h4>
        </div>

        <div style="left: 886px; top: 28px; opacity: 0;" id="tooltip1">
            <h4>Maine</h4>
            <table>
                <tbody>
                <tr><td>Low</td><td>56</td></tr>
                <tr><td>Average</td><td>76</td></tr>
                <tr><td>High</td><td>95</td></tr>
                </tbody>
            </table>
        </div><!-- div to hold tooltip1. -->


<script type="text/javascript">

    {
        var map = new AMap.Map("container", {
//        zoom: 0.2,
            center: [117.10, 39.10]
        });          // 创建地图实例
//    map.setZoom(0);


        AMap.plugin(['AMap.ToolBar', 'AMap.Scale'], function () {
            var toolBar = new AMap.ToolBar();
            var scale = new AMap.Scale();
            map.addControl(toolBar);
            map.addControl(scale);
        });


        var satellite = new AMap.TileLayer.Satellite({
            map: map,
            zIndex: 0,
            opacity: 0.2
        });

//    var marker = new AMap.Polyline({
//                        map:map,
//                        fillColor:"#f00",
//                        strokeColor:10,
//                        storkeStyle:"solid",
//                        path:[[117.36884,39.08735],[120.36884,20.08735]]
//    //                    animation:"AMAP_ANIMATION_DROP"
//                    });


//    var serverUrl = "http://192.168.1.103:8080/SavePlanes/mng/planes";
        var serverUrl = "http://localhost:8080/SavePlanes/mng";
//    var serverUrl = "http://172.26.42.9:8081/SavePlanes/mng/planes";

        var lines = [];


        function loadEachLine(id) {
            $.ajax({
                url: serverUrl + "/lines/" + id,
//             contentType:"application/json",
                type: 'get',
                dataType: 'JSON'
            }).success(function (data) {
                var points = [];
                data.points.forEach(function (e) {
                    points.push(new AMap.LngLat(e.lon, e.lat));
                });
                console.log("数据：\n" + data);
                var marker = new AMap.Polyline({
                    map: map,
                    strokeWeight: 2,
                    strokeColor: getRandomColor(),
                    storkeStyle: "solid",
                    path: points
                    //                    animation:"AMAP_ANIMATION_DROP"
                });
                lines.push(marker);

                var infoWindow = new AMap.InfoWindow();

                function markerClick(e) {
                    infoWindow.setContent(e.target.content);
                    infoWindow.open(map, e.lnglat);
                    hideOthers(lines);
                    removeOut();
                    e.target.setOptions({
                        strokeWeight: 10,
                        strokeOpacity: 1
                    });
                }

                function markerRightClick(e) {
                    infoWindow.setContent(e.target.content);
                    infoWindow.close(map, e.lnglat);
                    showOthers(lines);
                    addMouseOut();
                    e.target.setOptions({
                        strokeWeight: 2
                    });
                }

                function markerOver(e) {
                    e.target.setOptions({
                        strokeWeight: 10
                    });
                }

                function markerOut(e) {
                    e.target.setOptions({
                        strokeWeight: 2
                    });
                }

                function removeOut() {
                    marker.off('mouseout', markerOut);
                }

                function addMouseOut() {
                    marker.on('mouseout', markerOut);
                }

// 画轨迹
                marker.content = "<h4> " + data.fli + "</h4><table>" +
                "<tr><td>航班号</td><td>" + data.fli + "</td></tr>" +
                "<tr><td>飞机编号(地址)</td><td>  " + data.hex + "</td></tr>" +
                "<tr><td>起始经度</td><td>  " + (data.startLon) + "</td></tr>" +
                "<tr><td>起始纬度</td><td>  " + (data.startLat) + "</td></tr>" +
                "<tr><td>终止经度</td><td>  " + (data.endLon) + "</td></tr>" +
                "<tr><td>终止纬度</td><td>  " + (data.endLat) + "</td></tr>" +
                "<tr><td>起始时间</td><td>  " + (data.startTime) + "</td></tr>" +
                "<tr><td>终止时间</td><td>  " + (data.endTime) + "</td></tr>" +
                "<tr><td>方向</td><td>  " + (data.direction) + "</td></tr>" +
                "<tr><td>长度</td><td>  " + (marker.getLength()) + "米</td></tr>" +
                "</table>";
                //给Marker绑定单击事件
                marker.on('click', markerClick);
                marker.on('rightclick', markerRightClick);
                marker.on('mouseover', markerOver);
                marker.on('mouseout', markerOut);

            }).error(function (data) {
//            alert("获取失败");
                console.log(data);
                alert(data);
            });

        }

        function getRandomColor() {

            return '#' + (Math.random() * 0xffffff << 0).toString(16);
        }

        function hideOthers(lines) {
            lines.forEach(function (item) {
                item.setOptions({
                    strokeOpacity: 0.3
                });

            });
        }

        function showOthers(lines) {
            lines.forEach(function (item) {
                item.setOptions({
                    strokeOpacity: 1
                });
            });
        }

        function getAll() {
            console.log("从地图上选取-------------------------------" + AMap.Polyline());
        }

        $(document).ready(function () {
            for (var i = 0; i < 1000; i++) {
                loadEachLine(i + 1);
            }
            getAll();
        });

    }

    // d3
    {

        var width  = 600;
        var height = 520;
        var textColor= "#6B695D";

        var sideWidth = 600;
        var sideHeight = 600;


        function zoomedLeft() {
            d3.select(this).attr("transform",
                    "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }
        var zoomLeft = d3.behavior.zoom()
                .scaleExtent([1, 10])
                .on("zoom", zoomedLeft);
        var svgLeft = d3.select("#map5").append("svg")
                .attr("width", sideWidth)
                .attr("height", sideHeight)
                .append("g")
                .call(zoomLeft)
//            .call(drag)
                .attr("transform", "translate(0,0)");
    }


</script>
</body>
</html>